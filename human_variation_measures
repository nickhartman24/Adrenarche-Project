#WHAT I'M DOING HERE - discuss heterozygosity measures for overall average and by superpopulation. 

#calculating the heterozygosity rate for the 1000 GP humans for each gene of interest. 
#WHAT THIS DOES
#Example using CYB5A

# Start by creating a vcf of just the gene of interest
bcftools view -r 18:71920819-71959110 /pl/active/villanea_lab/data/modern_data/1000_genomes/20130502/ALL.chr18.phase3_shapeit2_mvncall_integrated_v5a.20130502.genotypes.vcf.gz -Oz -o CYB5A_1000GP_gene_region.vcf.gz

#Calculate per-individual homozygosity rates - reporting the number of homozygous sites (will work backwards to heterozygosity later)
# output has 5 columns - PUT THOSE COLUMN TITLES HERE
vcftools --gzvcf CYB5A_1000GP_gene_region.vcf.gz --het --out CYB5A_1000GP_homozyg_freq

#To Calculate individual heterozygosity 
awk 'NR>1 {print $1, ($4-$2)/$4}' CYB5A_1000GP_homozyg_freq.het > CYB5A_1000GP_indv_het_freq

# To Calculate a single number for average heterozygosity across ALL samples 
awk 'NR>1 {sum += ($4-$2)/$4; n++} END {print "Average heterozygosity:", sum/n}' CYB5A_1000GP_homozyg_freq.het > average_heterozygosity_ALL

#To get heterozygosity by superpopulation:
#first create a file with individual IDs and superpopulation
awk '{print $1 "\t" $3}' /pl/active/villanea_lab/data/modern_data/1000_genomes/20130502/integrated_call_samples_v3.20130502.ALL.panel > 1000GP_sample_superpop.txt

#Also will use the file "CYB5A_1000GP_indv_het_freq"
#merge the sample_superpop.txt file with the indv_het file:
sort CYB5A_1000GP_indv_het_freq > CYB5A_1000GP_indv_het.sorted.txt
sort 1000GP_sample_superpop.txt > 1000GP_sample_superpop.sorted.txt
join -1 1 -2 1 CYB5A_1000GP_indv_het.sorted.txt 1000GP_sample_superpop.sorted.txt > CYB5A_1000GP_het_rates_superpop.txt

#average heterozygosity by superpopulation
awk '{count[$3]++; sum[$3]+=$2} END {for (pop in sum) print pop, sum[pop]/count[pop]}' CYB5A_1000GP_het_rates_superpop.txt > CYB5A_heterozygosity_by_superpopulation.txt

